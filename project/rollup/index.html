<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>rollup 打包组件库和 react+ts+less 项目 | 斯基</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/hero.png">
    <meta name="description" content="我的个人网站">
    
    <link rel="preload" href="/assets/css/0.styles.b4c82722.css" as="style"><link rel="preload" href="/assets/js/app.0268c4c2.js" as="script"><link rel="preload" href="/assets/js/2.967aa7a2.js" as="script"><link rel="preload" href="/assets/js/77.98648d74.js" as="script"><link rel="prefetch" href="/assets/js/10.3bbb0807.js"><link rel="prefetch" href="/assets/js/11.8131cf96.js"><link rel="prefetch" href="/assets/js/12.e86cdf20.js"><link rel="prefetch" href="/assets/js/13.9fdb9be8.js"><link rel="prefetch" href="/assets/js/14.9e9bd6d6.js"><link rel="prefetch" href="/assets/js/15.92b49d1b.js"><link rel="prefetch" href="/assets/js/16.17485625.js"><link rel="prefetch" href="/assets/js/17.91a586dd.js"><link rel="prefetch" href="/assets/js/18.4074a6e7.js"><link rel="prefetch" href="/assets/js/19.3f58e737.js"><link rel="prefetch" href="/assets/js/20.e5a5f8bc.js"><link rel="prefetch" href="/assets/js/21.20d1875f.js"><link rel="prefetch" href="/assets/js/22.3d0ab17d.js"><link rel="prefetch" href="/assets/js/23.b2022f49.js"><link rel="prefetch" href="/assets/js/24.1af9666c.js"><link rel="prefetch" href="/assets/js/25.8d10354c.js"><link rel="prefetch" href="/assets/js/26.f52a33fc.js"><link rel="prefetch" href="/assets/js/27.b2e5641d.js"><link rel="prefetch" href="/assets/js/28.b58b6e58.js"><link rel="prefetch" href="/assets/js/29.6b7750c5.js"><link rel="prefetch" href="/assets/js/3.cc070fa9.js"><link rel="prefetch" href="/assets/js/30.9b26746b.js"><link rel="prefetch" href="/assets/js/31.700b31b7.js"><link rel="prefetch" href="/assets/js/32.b302b920.js"><link rel="prefetch" href="/assets/js/33.02b27f1f.js"><link rel="prefetch" href="/assets/js/34.625259a9.js"><link rel="prefetch" href="/assets/js/35.3bb21cc1.js"><link rel="prefetch" href="/assets/js/36.0950ffc4.js"><link rel="prefetch" href="/assets/js/37.df7f6ea5.js"><link rel="prefetch" href="/assets/js/38.37a2547a.js"><link rel="prefetch" href="/assets/js/39.a6a358e6.js"><link rel="prefetch" href="/assets/js/4.c7af42f4.js"><link rel="prefetch" href="/assets/js/40.4539fae2.js"><link rel="prefetch" href="/assets/js/41.3c9edf86.js"><link rel="prefetch" href="/assets/js/42.822be69b.js"><link rel="prefetch" href="/assets/js/43.3ada04a5.js"><link rel="prefetch" href="/assets/js/44.b249c729.js"><link rel="prefetch" href="/assets/js/45.40c9447d.js"><link rel="prefetch" href="/assets/js/46.359277f8.js"><link rel="prefetch" href="/assets/js/47.9637e422.js"><link rel="prefetch" href="/assets/js/48.9d70ff59.js"><link rel="prefetch" href="/assets/js/49.ff7ebfe4.js"><link rel="prefetch" href="/assets/js/5.e9df9c41.js"><link rel="prefetch" href="/assets/js/50.f1ce6ecd.js"><link rel="prefetch" href="/assets/js/51.78b99d7a.js"><link rel="prefetch" href="/assets/js/52.bbb53428.js"><link rel="prefetch" href="/assets/js/53.c19cd55b.js"><link rel="prefetch" href="/assets/js/54.18d5087d.js"><link rel="prefetch" href="/assets/js/55.d5ed6419.js"><link rel="prefetch" href="/assets/js/56.8ee19ccf.js"><link rel="prefetch" href="/assets/js/57.6b46d85f.js"><link rel="prefetch" href="/assets/js/58.a9920b5b.js"><link rel="prefetch" href="/assets/js/59.dd2b9940.js"><link rel="prefetch" href="/assets/js/6.236a6102.js"><link rel="prefetch" href="/assets/js/60.4d718e04.js"><link rel="prefetch" href="/assets/js/61.649aafa9.js"><link rel="prefetch" href="/assets/js/62.b22e91fe.js"><link rel="prefetch" href="/assets/js/63.efde161c.js"><link rel="prefetch" href="/assets/js/64.dee4480a.js"><link rel="prefetch" href="/assets/js/65.8a8e7012.js"><link rel="prefetch" href="/assets/js/66.0dd7e1a2.js"><link rel="prefetch" href="/assets/js/67.54117d06.js"><link rel="prefetch" href="/assets/js/68.6d88bd87.js"><link rel="prefetch" href="/assets/js/69.b8b47c11.js"><link rel="prefetch" href="/assets/js/7.62b5b99a.js"><link rel="prefetch" href="/assets/js/70.198d0b42.js"><link rel="prefetch" href="/assets/js/71.d3b20eb8.js"><link rel="prefetch" href="/assets/js/72.a4c0c8b3.js"><link rel="prefetch" href="/assets/js/73.9c00bc7b.js"><link rel="prefetch" href="/assets/js/74.e036abf7.js"><link rel="prefetch" href="/assets/js/75.b3961436.js"><link rel="prefetch" href="/assets/js/76.b66fb4ec.js"><link rel="prefetch" href="/assets/js/78.74f1545a.js"><link rel="prefetch" href="/assets/js/79.4dc18994.js"><link rel="prefetch" href="/assets/js/8.4d001794.js"><link rel="prefetch" href="/assets/js/80.1fb04678.js"><link rel="prefetch" href="/assets/js/81.9bdef5e3.js"><link rel="prefetch" href="/assets/js/9.c25b4807.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b4c82722.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">斯基</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/code/" class="nav-link">
  code记录
</a></div><div class="nav-item"><a href="/base/" class="nav-link">
  计算机基础
</a></div><div class="nav-item"><a href="/project/" class="nav-link router-link-active">
  前端工程
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  前端面试题
</a></div><div class="nav-item"><a href="/react/1.html" class="nav-link">
  react
</a></div><div class="nav-item"><a href="https://github.com/RunningSkey" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/code/" class="nav-link">
  code记录
</a></div><div class="nav-item"><a href="/base/" class="nav-link">
  计算机基础
</a></div><div class="nav-item"><a href="/project/" class="nav-link router-link-active">
  前端工程
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  前端面试题
</a></div><div class="nav-item"><a href="/react/1.html" class="nav-link">
  react
</a></div><div class="nav-item"><a href="https://github.com/RunningSkey" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/project/" aria-current="page" class="sidebar-link">目录</a></li><li><a href="/project/gitblit/" class="sidebar-link">搭建本地git服务器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/gitblit/#windows-系统快速搭建本地-git-服务器" class="sidebar-link">windows 系统快速搭建本地 git 服务器</a></li><li class="sidebar-sub-header"><a href="/project/gitblit/#git-常用命令" class="sidebar-link">git 常用命令</a></li><li class="sidebar-sub-header"><a href="/project/gitblit/#其他撤销修改命令" class="sidebar-link">其他撤销修改命令</a></li></ul></li><li><a href="/project/module/" class="sidebar-link">前端模块化方案</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/module/#前端工程化发展历程" class="sidebar-link">前端工程化发展历程</a></li><li class="sidebar-sub-header"><a href="/project/module/#原始时期" class="sidebar-link">原始时期</a></li><li class="sidebar-sub-header"><a href="/project/module/#立即执行函数-iife" class="sidebar-link">立即执行函数（IIFE）</a></li><li class="sidebar-sub-header"><a href="/project/module/#commonjs" class="sidebar-link">CommonJs</a></li><li class="sidebar-sub-header"><a href="/project/module/#amd" class="sidebar-link">AMD</a></li><li class="sidebar-sub-header"><a href="/project/module/#cmd" class="sidebar-link">CMD</a></li><li class="sidebar-sub-header"><a href="/project/module/#umd" class="sidebar-link">UMD</a></li><li class="sidebar-sub-header"><a href="/project/module/#esm" class="sidebar-link">ESM</a></li></ul></li><li><a href="/project/bundle-tool/" class="sidebar-link">前端打包工具</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/bundle-tool/#结论" class="sidebar-link">结论</a></li><li class="sidebar-sub-header"><a href="/project/bundle-tool/#webpack" class="sidebar-link">webpack</a></li><li class="sidebar-sub-header"><a href="/project/bundle-tool/#rollup" class="sidebar-link">rollup</a></li><li class="sidebar-sub-header"><a href="/project/bundle-tool/#vite" class="sidebar-link">vite</a></li></ul></li><li><a href="/project/rollup/" aria-current="page" class="active sidebar-link">rollup</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/rollup/#一-初始化项目" class="sidebar-link">一. 初始化项目</a></li><li class="sidebar-sub-header"><a href="/project/rollup/#二-实现-react-ts-打包组件库或者工具库" class="sidebar-link">二. 实现 react+ts 打包组件库或者工具库</a></li><li class="sidebar-sub-header"><a href="/project/rollup/#三-实现-react-ts-引用组件库或者工具库" class="sidebar-link">三. 实现 react+ts 引用组件库或者工具库</a></li><li class="sidebar-sub-header"><a href="/project/rollup/#四-添加代码规范-eslint-prettier-stylelint-husky-lint-staged" class="sidebar-link">四. 添加代码规范 eslint+prettier+stylelint+husky+lint-staged</a></li><li class="sidebar-sub-header"><a href="/project/rollup/#五-babel-的优化配置策略" class="sidebar-link">五. babel 的优化配置策略</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="rollup-打包组件库和-react-ts-less-项目"><a href="#rollup-打包组件库和-react-ts-less-项目" class="header-anchor">#</a> rollup 打包组件库和 react+ts+less 项目</h1> <h2 id="一-初始化项目"><a href="#一-初始化项目" class="header-anchor">#</a> 一. 初始化项目</h2> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">mkdir</span> y-design
<span class="token builtin class-name">cd</span> y-design
<span class="token function">npm</span> init -y
</code></pre></div><h2 id="二-实现-react-ts-打包组件库或者工具库"><a href="#二-实现-react-ts-打包组件库或者工具库" class="header-anchor">#</a> 二. 实现 react+ts 打包组件库或者工具库</h2> <h3 id="_1-安装-rollup-基础依赖"><a href="#_1-安装-rollup-基础依赖" class="header-anchor">#</a> 1. 安装 rollup 基础依赖</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> i -D rollup @rollup/plugin-commonjs @rollup/plugin-node-resolve
</code></pre></div><ul><li><code>@rollup/plugin-commonjs</code>: <code>rollup</code>收集依赖打包，是依赖<code>esModule</code>规范，而引入第三方<code>commonjs</code>规范的代码需要使用该插件进行转化为<code>esModule</code>才能使用<div class="custom-block warning"><p class="custom-block-title">rollup-plugin-commonjs</p> <p><code>rollup-plugin-commonjs</code>已被弃用，所以使用<code>@rollup/plugin-commonjs</code></p></div></li> <li><code>@rollup/plugin-node-resolve</code>: 如果没有该插件 <code>import</code> 引入的 第三包，会被转为 <code>require</code> <code>形式，不会将包打进入bundle.js</code><div class="custom-block warning"><p class="custom-block-title">rollup-plugin-node-resolve</p> <p><code>rollup-plugin-node-resolve</code>已被弃用，所以使用<code>@rollup/plugin-node-resolve</code></p></div></li></ul> <h3 id="_2-安装-react-相关依赖"><a href="#_2-安装-react-相关依赖" class="header-anchor">#</a> 2.安装 react 相关依赖</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> i react react-dom <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> i -D @types/react @types/react-dom
</code></pre></div><h3 id="_3-安装-typescript-相关依赖"><a href="#_3-安装-typescript-相关依赖" class="header-anchor">#</a> 3.安装 typescript 相关依赖</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> i -D typescript rollup-plugin-typescript2
</code></pre></div><h3 id="_4-安装-css-相关依赖"><a href="#_4-安装-css-相关依赖" class="header-anchor">#</a> 4.安装 css 相关依赖</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> i -D <span class="token function">less</span> postcss postcss-less rollup-plugin-postcss classnames
</code></pre></div><ul><li><code>rollup-plugin-postcss</code>: 默认支持 less、scss，但是需要安装对应前置插件</li> <li><code>classnames</code>: 可以使用函数来组合 jsx 语法的 class 名</li></ul> <h3 id="_4-编辑以下文件"><a href="#_4-编辑以下文件" class="header-anchor">#</a> 4.编辑以下文件</h3> <p><img src="/assets/img/15.png" alt=""></p> <details class="custom-block details"><summary>tsconfig.json</summary> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;jsx&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 可以使用jsx或tsx</span>
    <span class="token property">&quot;baseUrl&quot;</span><span class="token operator">:</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;outDir&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 输出目录</span>
    <span class="token property">&quot;sourceMap&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否生成sourceMap</span>
    <span class="token property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esnext&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 编译目标</span>
    <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esnext&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 模块类型</span>
    <span class="token property">&quot;moduleResolution&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;allowJs&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否编辑js文件</span>
    <span class="token property">&quot;strict&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 严格模式</span>
    <span class="token property">&quot;noUnusedLocals&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 未使用变量报错</span>
    <span class="token property">&quot;experimentalDecorators&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 启动装饰器</span>
    <span class="token property">&quot;resolveJsonModule&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 加载json</span>
    <span class="token property">&quot;esModuleInterop&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;removeComments&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 删除注释</span>
    <span class="token property">&quot;declaration&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 生成定义文件</span>
    <span class="token property">&quot;declarationMap&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 生成定义sourceMap</span>
    <span class="token comment">// &quot;declarationDir&quot;: &quot;./lib/types&quot;, // 定义文件输出目录</span>
    <span class="token property">&quot;lib&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;esnext&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dom&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 导入库类型定义</span>
    <span class="token property">&quot;types&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;node&quot;</span><span class="token punctuation">]</span> <span class="token comment">// 导入指定类型包</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;include&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;packages&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;typings.d.ts&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exclude&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div></details> <details class="custom-block details"><summary>rollup.config.js</summary> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> typescript <span class="token keyword">from</span> <span class="token string">&quot;rollup-plugin-typescript2&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> nodeResolve <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@rollup/plugin-node-resolve&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> commonjs <span class="token keyword">from</span> <span class="token string">&quot;@rollup/plugin-commonjs&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">&quot;path&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// import babel from &quot;@rollup/plugin-babel&quot;;</span>
<span class="token comment">//babel: 转换为es5语法，需要安装@babel/core，@babel/preset-env</span>
<span class="token comment">// import { terser } from &quot;rollup-plugin-terser&quot;;</span>
<span class="token comment">//terser 压缩代码</span>

<span class="token keyword">import</span> pkg <span class="token keyword">from</span> <span class="token string">&quot;./package.json&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// import cssnanoPlugin from &quot;cssnano&quot;;</span>
<span class="token keyword">import</span> postcss <span class="token keyword">from</span> <span class="token string">&quot;rollup-plugin-postcss&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// import autoprefixer from &quot;autoprefixer&quot;;</span>
<span class="token comment">// import clear from &quot;rollup-plugin-clear&quot;;</span>
<span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;packages/index.ts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;lib/cjs/index.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&quot;cjs&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> pkg<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;lib/es/index.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&quot;es&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> pkg<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;lib/umd/index.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&quot;umd&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> pkg<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token comment">//umd 模块 必须给name</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// clear({</span>
    <span class="token comment">//   targets: [&quot;lib&quot;],</span>
    <span class="token comment">// }),</span>
    <span class="token function">postcss</span><span class="token punctuation">(</span>
      <span class="token comment">// {</span>
      <span class="token comment">//   plugins: [autoprefixer(), cssnanoPlugin()],</span>
      <span class="token comment">// }</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">commonjs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">nodeResolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">extensions</span><span class="token operator">:</span>  <span class="token punctuation">[</span><span class="token string">&quot;.ts&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.tsx&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">typescript</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// babel({</span>
    <span class="token comment">//   exclude: &quot;node_modules/**&quot;,</span>
    <span class="token comment">//   extensions: [&quot;.ts&quot;, &quot;.tsx&quot;], //需要手动配置后缀，不然文件ts文件不会被转成es5</span>
    <span class="token comment">// }),</span>
    <span class="token comment">// terser(),</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 指出应将哪些模块视为外部模块 就不会被打包</span>
  <span class="token literal-property property">external</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;react&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;react-dom&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></details> <details class="custom-block details"><summary>packages/index.ts</summary> <div class="language-ts extra-class"><pre class="language-ts"><code>
<span class="token keyword">import</span> Button <span class="token keyword">from</span> <span class="token string">&quot;./Button/Button&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">count</span> <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span>
  count<span class="token punctuation">,</span>
  Button
<span class="token punctuation">}</span></code></pre></div></details> <details class="custom-block details"><summary>packages/Button/Button.tsx</summary> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> classnames <span class="token keyword">from</span> <span class="token string">&quot;classnames&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./index.less'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> prefix <span class="token operator">=</span> <span class="token string">'y'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span>props<span class="token operator">:</span> <span class="token punctuation">{</span>
  children<span class="token operator">:</span> React<span class="token punctuation">.</span>ReactNode<span class="token punctuation">;</span>
  type<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">&quot;default&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;primary&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cName <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-button</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
      <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">classnames</span><span class="token punctuation">(</span>cName<span class="token punctuation">,</span> cName <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>type <span class="token operator">||</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
    <span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div></details> <details class="custom-block details"><summary>packages/Button/index.less</summary> <div class="language-less extra-class"><pre class="language-less"><code><span class="token selector">.y-button</span><span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> inline<span class="token operator">-</span>block<span class="token punctuation">;</span>
  <span class="token property">font-weight</span><span class="token punctuation">:</span> 400<span class="token punctuation">;</span>
  <span class="token property">white-space</span><span class="token punctuation">:</span> nowrap<span class="token punctuation">;</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
  <span class="token property">background-image</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> 1px solid transparent<span class="token punctuation">;</span>
  <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 2px #00000004<span class="token punctuation">;</span>
  <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>
  <span class="token property">transition</span><span class="token punctuation">:</span> all .3s <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>.645<span class="token punctuation">,</span>.045<span class="token punctuation">,</span>.355<span class="token punctuation">,</span>1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token property">touch-action</span><span class="token punctuation">:</span> manipulation<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 4px 15px<span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> 2px<span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #000000d9<span class="token punctuation">;</span>
  <span class="token property">border-color</span><span class="token punctuation">:</span> #d9d9d9<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
  <span class="token selector">&amp;-primary</span><span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
    <span class="token property">border-color</span><span class="token punctuation">:</span> #1890ff<span class="token punctuation">;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> #1890ff<span class="token punctuation">;</span>
    <span class="token property">text-shadow</span><span class="token punctuation">:</span> 0 <span class="token operator">-</span>1px 0 <span class="token function">rgb</span><span class="token punctuation">(</span>0 0 0 <span class="token operator">/</span> 12%<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 2px #0000000b<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></details> <h4 id="package-json"><a href="#package-json" class="header-anchor">#</a> package.json</h4> <div class="language-json extra-class"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-json"><code><span class="token punctuation">{</span>
  ...<span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build:pro&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rollup -c&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  ...
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-运行命令即可打包"><a href="#_5-运行命令即可打包" class="header-anchor">#</a> 5.运行命令即可打包</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> run build:pro
</code></pre></div><h3 id="_6-优化代码-安装插件-编辑-babelrc-根据安装的插件将上面文件中的注释恢复"><a href="#_6-优化代码-安装插件-编辑-babelrc-根据安装的插件将上面文件中的注释恢复" class="header-anchor">#</a> 6.优化代码,安装插件,编辑.babelrc,根据安装的插件将上面文件中的注释恢复</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> i -D @rollup/plugin-babel @babel/core @babel/preset-env rollup-plugin-terser cssnano autoprefixer rollup-plugin-clear
</code></pre></div><ul><li><code>@rollup/plugin-babel</code>: 将 es6 以上的代码装换为 es5,前置依赖<code>@babel/core @babel/preset-env</code><div class="custom-block warning"><p class="custom-block-title">rollup-plugin-babel</p> <p><code>rollup-plugin-babel</code>已被弃用，所以使用<code>@rollup/plugin-babel</code></p></div></li> <li><code>rollup-plugin-terser</code>: js 压缩</li> <li><code>cssnano</code>: css 压缩</li> <li><code>rollup-plugin-clear</code>: 重新编译的时候清除上一次的文件</li></ul> <details class="custom-block details"><summary>.babelrc</summary> <div class="language-babelrc extra-class"><pre class="language-text"><code>{
  &quot;presets&quot;: [
    [
      &quot;@babel/preset-env&quot;,
      {
        &quot;targets&quot;: {
          &quot;ie&quot;: 10 
          //如果代码运行的浏览器支持 ES Modules,应当指定如下配置.不过,此时 browsers 选项将被忽略
          // &quot;esmodules&quot;: true
        }
      }
    ]
  ]
}
</code></pre></div></details> <h2 id="三-实现-react-ts-引用组件库或者工具库"><a href="#三-实现-react-ts-引用组件库或者工具库" class="header-anchor">#</a> 三. 实现 react+ts 引用组件库或者工具库</h2> <h3 id="_1-在以上基础下-再创建rollup-config-dev-js-examples-app-tsx-examples-index-tsx"><a href="#_1-在以上基础下-再创建rollup-config-dev-js-examples-app-tsx-examples-index-tsx" class="header-anchor">#</a> 1. 在以上基础下，再创建<code>rollup.config.dev.js</code>,<code>examples/App.tsx</code>,<code>examples/index.tsx</code>,</h3> <h3 id="examples-style-less-examples-typeings-d-ts-public-index-html"><a href="#examples-style-less-examples-typeings-d-ts-public-index-html" class="header-anchor">#</a> <code>examples/style.less</code>,<code>examples/typeings.d.ts</code>,<code>public/index.html</code></h3> <p><img src="/assets/img/16.png" alt=""></p> <details class="custom-block details"><summary>rollup.config.dev.js</summary> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><div class="highlighted"> </div><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-js"><code><span class="token keyword">import</span> typescript <span class="token keyword">from</span> <span class="token string">&quot;rollup-plugin-typescript2&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> nodeResolve <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@rollup/plugin-node-resolve&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> commonjs <span class="token keyword">from</span> <span class="token string">&quot;@rollup/plugin-commonjs&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">&quot;path&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> babel <span class="token keyword">from</span> <span class="token string">&quot;@rollup/plugin-babel&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//babel: 转换为es5语法，需要安装@babel/core，@babel/preset-env</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> terser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rollup-plugin-terser&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//terser 压缩代码</span>

<span class="token comment">// import pkg from &quot;./package.json&quot;;</span>
<span class="token keyword">import</span> cssnanoPlugin <span class="token keyword">from</span> <span class="token string">&quot;cssnano&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> postcss <span class="token keyword">from</span> <span class="token string">&quot;rollup-plugin-postcss&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> replace <span class="token keyword">from</span> <span class="token string">&quot;@rollup/plugin-replace&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> autoprefixer <span class="token keyword">from</span> <span class="token string">&quot;autoprefixer&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> clear <span class="token keyword">from</span> <span class="token string">&quot;rollup-plugin-clear&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//预览</span>
<span class="token keyword">import</span> htmlTemplate <span class="token keyword">from</span> <span class="token string">&quot;rollup-plugin-generate-html-template&quot;</span><span class="token punctuation">;</span><span class="token comment">//</span>
<span class="token keyword">import</span> livereload <span class="token keyword">from</span> <span class="token string">&quot;rollup-plugin-livereload&quot;</span><span class="token punctuation">;</span><span class="token comment">//</span>
<span class="token keyword">import</span> serve <span class="token keyword">from</span> <span class="token string">&quot;rollup-plugin-serve&quot;</span><span class="token punctuation">;</span><span class="token comment">//</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;examples/index.tsx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//</span>
    <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">&quot;dist/main.js&quot;</span><span class="token punctuation">,</span><span class="token comment">//</span>
    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&quot;cjs&quot;</span><span class="token punctuation">,</span><span class="token comment">//</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">targets</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;dist&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">//</span>
    <span class="token function">htmlTemplate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&quot;public/index.html&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&quot;dist/index.html&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">serve</span><span class="token punctuation">(</span><span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">livereload</span><span class="token punctuation">(</span><span class="token string">&quot;examples&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">replace</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">preventAssignment</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;process.env.NODE_ENV&quot;</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">&quot;production&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 否则会报：process is not defined的错</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">//</span>
    <span class="token function">postcss</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">autoprefixer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cssnanoPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token comment">// 可以使用 import style from './style.less';</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">commonjs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">nodeResolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">extensions</span><span class="token operator">:</span>  <span class="token punctuation">[</span><span class="token string">&quot;.ts&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.tsx&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">typescript</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token string">&quot;node_modules/**&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;.ts&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.tsx&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//需要手动配置后缀，不然文件ts文件不会被转成es5</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">terser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 指出应将哪些模块视为外部模块 就不会被打包</span>
  <span class="token comment">// external: [&quot;react&quot;, &quot;react-dom&quot;], 生产或开发的时候需要打包进去</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></details> <details class="custom-block details"><summary>examples/App.tsx</summary> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../lib/es&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> style <span class="token keyword">from</span> <span class="token string">'./style.less'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>style<span class="token punctuation">.</span>App<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>App-header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">header</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">primary</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">default</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre></div></details> <details class="custom-block details"><summary>examples/index.tsx</summary> <div class="language-tsx extra-class"><pre class="language-tsx"><code>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">&quot;react-dom&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;./App&quot;</span><span class="token punctuation">;</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></details> <details class="custom-block details"><summary>examples/style.less</summary> <div class="language-less extra-class"><pre class="language-less"><code><span class="token selector">.App</span><span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 800px<span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> 10px auto<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div></details> <details class="custom-block details"><summary>examples/typeings.d.ts</summary> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'*.less'</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> classes <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token keyword">readonly</span> <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> classes
<span class="token punctuation">}</span> </code></pre></div></details> <details class="custom-block details"><summary>public/index.html</summary> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></code></pre></div></details> <div class="custom-block warning"><p class="custom-block-title">注意一下 tsconfig.json</p> <p><code>tsconfig.json</code>这个文件需要注意一下，<code>npm run build:pro</code>的时候 <code>&quot;include&quot;: [&quot;packages&quot;, &quot;typings.d.ts&quot;]</code>,
<code>npm run dev</code> 的时候要加上<code>&quot;examples&quot;</code>，即：<code>&quot;include&quot;: [&quot;packages&quot;, &quot;typings.d.ts&quot;,&quot;examples&quot;]</code></p></div> <h3 id="_2-添加-dev-命令"><a href="#_2-添加-dev-命令" class="header-anchor">#</a> 2. 添加 dev 命令</h3> <h4 id="package-json-2"><a href="#package-json-2" class="header-anchor">#</a> package.json</h4> <div class="language-json extra-class"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-json"><code><span class="token punctuation">{</span>
  ...<span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build:pro&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rollup -c&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rollup -wc rollup.config.dev.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  ...
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-安装依赖"><a href="#_3-安装依赖" class="header-anchor">#</a> 3. 安装依赖</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> i -D rollup-plugin-generate-html-template rollup-plugin-livereload rollup-plugin-serve
</code></pre></div><ul><li><code>rollup-plugin-generate-html-template</code>: 使用 html 模板</li> <li><code>rollup-plugin-livereload</code>: 实时刷新页面</li> <li><code>rollup-plugin-serve</code>: 启动一个服务器</li></ul> <h3 id="_4-运行命令实现在线预览"><a href="#_4-运行命令实现在线预览" class="header-anchor">#</a> 4.运行命令实现在线预览</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> run dev
</code></pre></div><p><img src="/assets/img/17.png" alt=""></p> <h2 id="四-添加代码规范-eslint-prettier-stylelint-husky-lint-staged"><a href="#四-添加代码规范-eslint-prettier-stylelint-husky-lint-staged" class="header-anchor">#</a> 四. 添加代码规范 eslint+prettier+stylelint+husky+lint-staged</h2> <h3 id="_1-eslint"><a href="#_1-eslint" class="header-anchor">#</a> 1. eslint</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> i eslint -D

npx eslint --init
</code></pre></div><ul><li><code>npx eslint --init</code> 根据选择自定义安装依赖，完成以后生成.eslintrc.js<details class="custom-block details"><summary>.eslintrc.js</summary> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">browser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">es2021</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">'eslint:recommended'</span><span class="token punctuation">,</span>
      <span class="token string">'plugin:react/recommended'</span><span class="token punctuation">,</span>
      <span class="token string">'plugin:@typescript-eslint/recommended'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">overrides</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">'@typescript-eslint/parser'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">parserOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">ecmaFeatures</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">jsx</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//这几行自己加的</span>
      <span class="token literal-property property">ecmaVersion</span><span class="token operator">:</span> <span class="token string">'latest'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">'module'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'react'</span><span class="token punctuation">,</span> <span class="token string">'@typescript-eslint'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'no-undef'</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token comment">//这几行自己加的</span>
      <span class="token string-property property">'@typescript-eslint/no-unused-vars'</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token comment">//这几行自己加的</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  </code></pre></div></details></li></ul> <h3 id="_2-prettier"><a href="#_2-prettier" class="header-anchor">#</a> 2. prettier</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> i prettier eslint-config-prettier eslint-plugin-prettier -D
</code></pre></div><ul><li><code>eslint-config-prettier</code>解决<code>eslint</code>和<code>prettier</code>的冲突配置，保证 prettier 格式不出错</li> <li><code>eslint-plugin-prettier</code>配置<code>eslint --fix</code>采用<code>prettier</code>的配置规则格式化</li></ul> <details class="custom-block details"><summary>创建.prettierrc.js</summary> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>
<span class="token comment">/** @format */</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">singleQuote</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">trailingComma</span><span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">printWidth</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  <span class="token literal-property property">proseWrap</span><span class="token operator">:</span> <span class="token string">'never'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">endOfLine</span><span class="token operator">:</span> <span class="token string">'lf'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">overrides</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">files</span><span class="token operator">:</span> <span class="token string">'.prettierrc'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">'json'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">files</span><span class="token operator">:</span> <span class="token string">'document.ejs'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">'html'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></details> <h3 id="_3-stylelint"><a href="#_3-stylelint" class="header-anchor">#</a> 3.stylelint</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> i stylelint stylelint-config-css-modules stylelint-config-prettier stylelint-config-standard stylelint-declaration-block-no-ignored-properties -D
</code></pre></div><ul><li><code>stylelint-config-prettier</code>解决<code>stylelint</code>和<code>prettier</code>的冲突配置，保证 prettier 格式不出错</li></ul> <details class="custom-block details"><summary>创建.stylelintrc.js</summary> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>
<span class="token comment">/** @format */</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'stylelint-config-standard'</span><span class="token punctuation">,</span>
    <span class="token string">'stylelint-config-css-modules'</span><span class="token punctuation">,</span>
    <span class="token string">'stylelint-config-prettier'</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">customSyntax</span><span class="token operator">:</span> <span class="token string">'postcss-less'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'stylelint-declaration-block-no-ignored-properties'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'no-descending-specificity'</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token comment">//https://github.com/stylelint/stylelint/issues/4114</span>
    <span class="token comment">// 'function-calc-no-invalid': null,</span>
    <span class="token string-property property">'function-url-quotes'</span><span class="token operator">:</span> <span class="token string">'always'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'selector-attribute-quotes'</span><span class="token operator">:</span> <span class="token string">'always'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'font-family-no-missing-generic-family-keyword'</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token string-property property">'plugin/declaration-block-no-ignored-properties'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">'unit-no-unknown'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">ignoreUnits</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'rpx'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// webcomponent</span>
    <span class="token string-property property">'selector-type-no-unknown'</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token string-property property">'value-keyword-case'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'lower'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">ignoreProperties</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'composes'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">'declaration-block-no-shorthand-property-overrides'</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">ignoreFiles</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'**/*.js'</span><span class="token punctuation">,</span> <span class="token string">'**/*.jsx'</span><span class="token punctuation">,</span> <span class="token string">'**/*.tsx'</span><span class="token punctuation">,</span> <span class="token string">'**/*.ts'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></details> <h3 id="_4-husky-lint-staged"><a href="#_4-husky-lint-staged" class="header-anchor">#</a> 4.husky + lint-staged</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> i husky lint-staged -D
</code></pre></div><ul><li><code>husky</code>: husky 是 Git hooks 工具，提供很多 git 操作的钩子</li></ul> <p>编辑<code>package.json</code>文件，并运行 prepare 命令,进行初始化 husky</p> <h4 id="package-json-3"><a href="#package-json-3" class="header-anchor">#</a> package.json</h4> <div class="language-json extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre class="language-json"><code><span class="token punctuation">{</span>
  ...<span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build:pro&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rollup -c&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rollup -wc rollup.config.dev.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;prepare&quot;</span><span class="token operator">:</span> <span class="token string">&quot;husky install&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;lint-staged&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;**/**.{js,jsx,json,ts,tsx}&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;prettier --write&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;eslint --fix&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;git add&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;**/*.less&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;prettier --write&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;stylelint --fix&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;git add&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  ...
<span class="token punctuation">}</span>
</code></pre></div><div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> run prepare
npx husky <span class="token function">add</span> .husky/pre-commit <span class="token string">&quot;npx lint-staged&quot;</span>
</code></pre></div><p><img src="/assets/img/18.png" alt=""></p> <p>配置完成，进行测试</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">git</span> init
<span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span>
<span class="token function">git</span> commit -m <span class="token string">&quot;test&quot;</span>
</code></pre></div><h2 id="五-babel-的优化配置策略"><a href="#五-babel-的优化配置策略" class="header-anchor">#</a> 五. babel 的优化配置策略</h2> <ol><li>安装依赖</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> @babel/runtime @babel/runtime-corejs3
</code></pre></div><ol start="2"><li>编辑<code>.babelrc</code>，<code>rollup.config.js</code>，<code>rollup.config.dev.js</code></li></ol> <h3 id="babelrc"><a href="#babelrc" class="header-anchor">#</a> .babelrc</h3> <div class="language-json extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;@babel/plugin-external-helpers&quot;</span><span class="token punctuation">,</span><span class="token comment">// 把 helpers 收集到一个共享模块或共享文件</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;@babel/plugin-transform-runtime&quot;</span><span class="token punctuation">,</span><span class="token comment">//依赖@babel/runtime 生产依赖</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;corejs&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token comment">//配置安装 @babel/runtime-corejs3 生产依赖</span>
        <span class="token property">&quot;useESModules&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//不转换esm的代码，让其支持tree-shaking。交给rollup去转换esm。</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="rollup-config-js-rollup-config-dev-js"><a href="#rollup-config-js-rollup-config-dev-js" class="header-anchor">#</a> rollup.config.js rollup.config.dev.js</h3> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code>  <span class="token operator">...</span><span class="token punctuation">,</span>
  <span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token string">'node_modules/**'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'.ts'</span><span class="token punctuation">,</span> <span class="token string">'.tsx'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//需要手动配置后缀，不然文件ts文件不会被转成es5</span>
      <span class="token literal-property property">babelHelpers</span><span class="token operator">:</span> <span class="token string">'runtime'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
</code></pre></div><p>完整代码<a href="https://github.com/RunningSkey/YDesign" target="_blank" rel="noopener noreferrer">YDesign<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/14/2022, 8:51:33 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/project/bundle-tool/" class="prev">
        前端打包工具
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.0268c4c2.js" defer></script><script src="/assets/js/2.967aa7a2.js" defer></script><script src="/assets/js/77.98648d74.js" defer></script>
  </body>
</html>
